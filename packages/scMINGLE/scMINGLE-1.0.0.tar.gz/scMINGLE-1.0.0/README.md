[![PyPI](https://img.shields.io/pypi/v/ContrastGCN.svg)](https://pypi.org/project/ContrastGCN)

[![Downloads](https://pepy.tech/badge/ContrastGCN)](https://pepy.tech/project/ContrastGCN)

# **MINGLE: A mutual information-based interpretable framework for automatic cell type annotation in single-cell chromatin accessibility data**

![MINGLE](./MINGLE.png)

## Installation

It's prefered to create a new environment for MINGLE:

```python
conda create -n MINGLE python==3.7
conda activate MINGLE
```

ContrastGCN is available on PyPI, and could be installed using:

```python
pip install scMINGLE
```

This process will take approximately 5 to 10 minutes, depending on the user's computer device and internet connectivition.

## Quick Start

The main function `scMINGLE.network.predict` can perform cell type annotation, identification of novel cell types, and model interpretation. If you do not wish to modify the parameter settings for the contrastive learning phase, you can conveniently use the MINGLE model by simply importing `scMINGLE.network.predict`.

```python
from scMINGLE import predict
```

### 1. Data

You should input the scATAC-seq data as **AnnData** object. Make sure that the column name corresponding to the cell type  and the column name corresponding to the peak in training set and test set are identical.

### 2. Model

#### Cell type annotation

```python
predict(train_adata, test_adata, cell_row, peak_col, save_path=save_path)
```

| Parameters | Description                                                  |
| ---------- | ------------------------------------------------------------ |
| train_data | AnnData object of shape `n_obs` × `n_vars`.                  |
| test_data  | AnnData object of shape `n_obs` × `n_vars`.                  |
| cell_row   | The column name corresponding to the cell type in `adata.obs`, default value is set to `cell_type`. |
| peak_col   | The column name corresponding to the peak in `adata.var`, default value is set to `peak`. |
| save_path  | The base directory path where results, models, and other output files should be saved. |

After execution,MINGLE will create a `ContrastGCN` folder in the specified `save_path`. This folder will contain the following outputs: `result.csv`, `report.csv`, `cl_model.pth`, and `gcn_model.pth`

| Output files  | Description                                                  |
| ------------- | ------------------------------------------------------------ |
| result.csv    | The annotation results generated by MINGLE.                  |
| report.csv    | The model's performance scores based on four evaluation metrics. |
| cl_model.pth  | A saved model file containing the weights of the MLP trained during the contrastive learning phase. |
| gcn_model.pth | A saved model file containing the weights of the GCN trained during the GCN phase. |

#### Identify novel cell type

```python
predict(train_adata, test_adata, cell_row, peak_col, uncover_novel=True,save_path=save_pat)
```

Once the parameter `uncover_novel` is set to `True`, MINGLE will identify the novel types in test set to `Novel type` and saves them in `result.csv`.

#### Explain the model

```python
predict(train_adata, test_adata, cell_row, peak_col, explainer=True,save_path=save_pat)
```

Once `explainer` is set to `True`, MINGLE will iterate through all cell types in the training set, identify cell-type-specific peaks, and create a **DataFrame** with the column name `'peak'`, where each row stores the name of a peak. The **DataFrame** is saved as `cell-specific-peaks_of_{the name of the specific cell type}.csv`.