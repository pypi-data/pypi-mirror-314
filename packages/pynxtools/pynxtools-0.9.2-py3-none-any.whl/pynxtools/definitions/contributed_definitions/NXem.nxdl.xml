<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="application" type="group" name="NXem" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
         Application definition for normalized representation of electron microscopy research.
         
         This application definition is a comprehensive example for a general description
         with which to normalize specific pieces of information and data collected within
         electron microscopy research.
         
         NXem is designed to be used for documenting experiments or computer simulations in which
         controlled electron beams are used for studying electron-beam matter interaction to explore
         physical mechanisms and phenomena, or to characterize materials with an electron microscope.
    </doc>
    <!--\@NX_class:
\@file_time(NX_DATE_TIME):
\@file_name(NX_CHAR):
\@file_update_time(NX_DATE_TIME):
\@NeXus_version(NX_CHAR):
\@HDF5_Version(NX_CHAR):
\@h5py_version(NX_CHAR):
\@default(NX_CHAR):
starting to reorganize the docstrings, as a list of blocks:
-| req: first part, concept definition, human-readable but such that one could take as is to define an concept in OWL
-| opt: second part, comment, i.e. information that in an ideal world would be ideal if represented strongly semantic
   but for practical purposes currently is interpretable only by human to provide them further contextualization
-| recommended: xref part (ideally also as a list of triple (spec, term, url to uri)-->
    <group type="NXentry" minOccurs="1" maxOccurs="unbounded">
        <field name="definition" type="NX_CHAR">
            <attribute name="version" type="NX_CHAR" optional="true"/>
            <enumeration>
                <item value="NXem"/>
            </enumeration>
        </field>
        <group name="profiling" type="NXcs_profiling" optional="true">
            <doc>
                 The configuration of the I/O writer software (e.g. `pynxtools &lt;https://github.com/FAIRmat-NFDI/pynxtools&gt;`_ or its plugins)
                 which was used to generate this NeXus file instance.
            </doc>
            <group name="programID" type="NXprogram" minOccurs="0" maxOccurs="unbounded">
                <doc>
                     A collection of all programs and libraries that are considered as relevant
                     to understand with which software tools this NeXus file instance was
                     generated. Ideally, to enable a binary recreation from the input data.
                     
                     Examples include the name and version of the libraries used to write the
                     instance. Ideally, the software which writes these NXprogram instances
                     also includes the version of the set of NeXus classes i.e. the specific
                     set of base classes, application definitions, and  contributed definitions
                     with which the here described concepts can be resolved.
                     
                     For the `pynxtools library &lt;https://github.com/FAIRmat-NFDI/pynxtools&gt;`_
                     which is used by the `NOMAD &lt;https://nomad-lab.eu/nomad-lab&gt;`_
                     research data management system, it makes sense to store e.g. the GitHub
                     repository commit and respective submodule references used.
                </doc>
                <field name="program" type="NX_CHAR">
                    <attribute name="version" type="NX_CHAR"/>
                </field>
            </group>
        </group>
        <group name="experiment_identifier" type="NXidentifier" recommended="true">
            <doc>
                 Ideally, a (globally) unique persistent identifier for referring to this experiment.
                 
                 An experiment should be understood in that this can be an experiment
                 in reality or a computer simulation because also the latter is an experiment
                 (see the Cambridge Dictionary experiment *a test done in order to find out
                 something, eg if an idea is correct*).
                 
                 The identifier is usually issued by the facility, laboratory, or the principle investigator.
                 The identifier enables to link experiments/simulations to e.g. proposals.
            </doc>
            <field name="service" type="NX_CHAR"/>
            <field name="identifier" type="NX_CHAR"/>
            <field name="is_persistent" type="NX_BOOLEAN"/>
        </group>
        <field name="experiment_alias" type="NX_CHAR">
            <doc>
                 Alias which scientists can easier identify this experiment by.
            </doc>
        </field>
        <field name="experiment_description" type="NX_CHAR" optional="true">
            <doc>
                 Free-text description about the experiment.
                 
                 Users are strongly advised to parameterize the description of their experiment
                 by using respective groups and fields and base classes instead of writing prose
                 into the field. The reason is that such free-text field is difficult to machine-interpret.
                 The motivation behind keeping this field for now is to learn in how far the
                 current base classes need extension based on user feedback.
            </doc>
        </field>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 ISO 8601 time code with local time zone offset to UTC information included
                 when the microscope session started. If the application demands that time
                 codes in this section of the application definition should only be used
                 for specifying when the experiment was performed - and the exact
                 duration is not relevant use this start_time field.
                 
                 Often though it is useful to specify a time interval via setting both a start_time
                 and an end_time because this enables software tools and users to collect a
                 more detailed bookkeeping of the experiment.
                 
                 Users should be aware though that even with having both time instances
                 specified, it may not be possible to infer how long the experiment took or
                 for how long data were acquired.
                 
                 More detailed timing data over the course of the experiment have
                 to be collected to compute this. These computations can take
                 advantage of individual time stamps start_time and end_time
                 in :ref:`NXevent_data_em` instances.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME" recommended="true">
            <doc>
                 ISO 8601 time code with local time zone offset to UTC included when
                 the microscope session ended.
                 
                 See docstring of the start_time field to see how to use the
                 start_time and end_time together.
            </doc>
        </field>
        <group name="citeID" type="NXcite" minOccurs="0" maxOccurs="unbounded"/>
        <group name="serializedID" type="NXserialized" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 Possibility to store a collection of serialized resources associated with the
                 experiment.
                 
                 An example how to use this set could be to document from which files, which have been
                 e.g. generated by software of technology partners, the information in an instance of
                 NXem was filled with during parsing or transcoding between different formats.
            </doc>
            <field name="type" type="NX_CHAR"/>
            <field name="path" type="NX_CHAR"/>
            <field name="checksum" type="NX_CHAR"/>
            <field name="algorithm" type="NX_CHAR"/>
        </group>
        <!--
this is one of the few examples where groups may end up without fields because
for reasons of not breaking GDPR compliance
-->
        <group name="userID" type="NXuser" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 Information about persons who performed or were involved in the microscope
                 session or simulation run.
                 
                 This can be the principle investigator who performed this experiment or the student who performed simulations.
                 Adding multiple users if relevant is recommended.
            </doc>
            <field name="name" type="NX_CHAR" optional="true">
                <doc>
                     Given (first) name and surname.
                </doc>
            </field>
            <field name="affiliation" type="NX_CHAR" optional="true">
                <doc>
                     Name of the affiliation at the point in time when the experiment was performed.
                </doc>
            </field>
            <field name="address" type="NX_CHAR" optional="true">
                <doc>
                     Postal address of the affiliation.
                </doc>
            </field>
            <field name="email" type="NX_CHAR" optional="true">
                <doc>
                     Email address at the point in time when the experiment was performed.
                     
                     Writing the most permanently used email is recommended.
                </doc>
            </field>
            <field name="telephone_number" type="NX_CHAR" optional="true">
                <doc>
                     Telephone number at the point in time when the experiment was performed.
                </doc>
            </field>
            <field name="role" type="NX_CHAR" optional="true">
                <doc>
                     User role at the point in time when the experiment was performed.
                     
                     Examples are technician operating the microscope, student, postdoc,
                     principle investigator, or guest.
                </doc>
            </field>
            <group name="identifier" type="NXidentifier" optional="true">
                <doc>
                     Identifier offered by a service to report the user other than by using its name.
                     
                     Examples could be an ORCID or social media account of the user.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
        </group>
        <group name="sample" type="NXsample">
            <doc>
                 A physical entity which contains material intended to be investigated.
                 Sample and specimen are treated as de facto synonyms. Samples can be real or virtual ones.
                 
                 This concept is related to term `Specimen`_ of the EMglossary standard.
                 
                 .. _Specimen: https://purls.helmholtz-metadaten.de/emg/EMG_00000046
            </doc>
            <field name="type" type="NX_CHAR">
                <doc>
                     Qualifier whether the sample is a real or a virtual one.
                </doc>
                <enumeration>
                    <item value="experiment"/>
                    <item value="simulation"/>
                </enumeration>
            </field>
            <group name="identifier" type="NXidentifier" recommended="true">
                <doc>
                     Ideally, (globally) unique persistent identifier which distinguishes the sample from all others
                     and especially the predecessor/origin from where that sample was cut.  The terms sample
                     and specimen are here considered as exact synonyms.
                     
                     This field must not be used for an alias! Instead, use name.
                     
                     In cases where multiple specimens were loaded into the microscope, the identifier has to resolve
                     the specific sample, whose results are stored by this :ref:`NXentry` instance because a single
                     NXentry should be used for the characterization of a single specimen.
                     
                     Details about the specimen preparation should be stored in resources referring to parent_identifier.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
            <group name="parent_identifier" type="NXidentifier" recommended="true">
                <doc>
                     Identifier of the sample from which the sample was cut or the string *None*.
                     
                     The purpose of this field is to support functionalities for tracking
                     sample provenance in a research data management system.
                </doc>
                <field name="service" type="NX_CHAR"/>
                <field name="identifier" type="NX_CHAR"/>
                <field name="is_persistent" type="NX_BOOLEAN"/>
            </group>
            <field name="preparation_date" type="NX_DATE_TIME">
                <doc>
                     ISO 8601 time code with local time zone offset to UTC information
                     when the specimen was prepared.
                     
                     Ideally, report the end of the preparation, i.e. the last known timestamp when
                     the measured specimen surface was actively prepared. Ideally, this matches
                     the last timestamp that is mentioned in the digital resource pointed to by
                     parent_identifier.
                     
                     Knowing when the specimen was exposed to e.g. specific atmosphere is especially
                     required for environmentally sensitive material such as specimen charged with hydrogen
                     or experiments including tracers that have a short halflife. Additional time stamps
                     prior to preparation_date should better be placed in resources which describe but
                     which do not pollute the description here with prose. Resolving these connected
                     pieces of information is considered the responsibility of the
                     research data management system not of a NeXus file.
                </doc>
            </field>
            <field name="name" type="NX_CHAR" recommended="true">
                <doc>
                     An alias used to refer to the specimen to please readability for humans.
                </doc>
            </field>
            <field name="atom_types" type="NX_CHAR">
                <doc>
                     List of comma-separated elements from the periodic table that are contained in the sample.
                     If the sample substance has multiple components, all elements from each component
                     must be included in atom_types.
                     
                     The purpose of the field is to offer research data management systems an opportunity
                     to parse the relevant elements without having to interpret these from the resources
                     pointed to by parent_identifier or walk through eventually deeply nested groups in
                     individual data instances.
                </doc>
            </field>
            <field name="thickness" type="NX_NUMBER" optional="true" units="NX_LENGTH">
                <doc>
                     (Measured) sample thickness.
                     
                     The information is recorded to qualify if the beam used was likely
                     able to shine through the specimen. For scanning electron microscopy,
                     in many cases the specimen is typically thicker than what is
                     illuminatable by the electron beam.
                     
                     In this case the value should be set to the actual thickness of
                     the specimen viewed for an illumination situation where the nominal
                     surface normal of the specimen is parallel to the optical axis.
                </doc>
            </field>
            <!--\@units: nm
NEW ISSUE: error estimates of the thickness and origin, i.e. how the value was obtained would be useful
NEW ISSUE: error model
NEW ISSUE: the KIT/SCC SEM, TEM schemata further qualify samples whether they are conductive e/ibeam sensitive
etc. The problem with this is that beam sensitivity is too vague but spatiotemporal electron dose integral dependent
KIT/SCC distinguish further conductivity and magnetic properties. While the motivation is clear, making
it thus simple is likely problematic when the data entered in such fields remaining qualitative.
what are good or bad properties, it would make sense though to quantify these values
this includes the description of eventual plasma cleaning steps,
just knowing that a sample was plasma cleaned is insufficient, maybe it was not cleaned long enough
if plasma cleaning is done outside the EM than its certainly history, if it happens inside the EM
are the ibeam description capabilities not sufficient enough?-->
            <field name="density" type="NX_NUMBER" optional="true" units="NX_ANY">
                <doc>
                     (Measured) density of the specimen.
                     
                     For multi-layered specimens this field should only be used to describe
                     the density of the excited volume. For scanning electron microscopy
                     the usage of this field is discouraged and instead an instance of an 
                     :ref:`NXinteraction_vol_em` within individual :ref:`NXevent_data_em`
                     instances can provide a cleaner description of the relevant details
                     why one may wish to store the density of the specimen.
                </doc>
            </field>
            <field name="description" type="NX_CHAR" optional="true">
                <doc>
                     Discouraged free-text field to provide further detail although adding
                     parent_identifier and having a working research data management system
                     should provide this contextualization.
                </doc>
            </field>
        </group>
        <group name="coordinate_system_set" type="NXcoordinate_system_set" minOccurs="1" maxOccurs="1">
            <doc>
                 Set to hold different coordinate systems conventions.
                 
                 Inspect the description of the :ref:`NXcoordinate_system_set` and :ref:`NXcoordinate_system` base classes
                 how to define coordinate systems in NeXus.
            </doc>
            <group type="NXcoordinate_system" minOccurs="1" maxOccurs="unbounded">
                <field name="alias" type="NX_CHAR" optional="true"/>
                <field name="type" type="NX_CHAR"/>
                <field name="handedness" type="NX_CHAR"/>
                <field name="origin" type="NX_CHAR"/>
            </group>
            <group name="processing_reference_frame" type="NXcoordinate_system" recommended="true">
                <field name="alias" type="NX_CHAR" optional="true"/>
                <field name="type" type="NX_CHAR"/>
                <field name="handedness" type="NX_CHAR"/>
                <field name="origin" type="NX_CHAR" recommended="true">
                    <doc>
                         Location of the origin of the processing_reference_frame.
                         
                         It is assumed that regions-of-interest in this reference frame form a rectangle or cuboid.
                         Edges are interpreted by inspecting the direction of their outer unit normals
                         (which point either parallel or antiparallel) along respective base vector direction
                         of the reference frame.
                         
                         If any of these assumptions is not met, the user is required to explicitly state this.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="front_top_left"/>
                        <item value="front_top_right"/>
                        <item value="front_bottom_right"/>
                        <item value="front_bottom_left"/>
                        <item value="back_top_left"/>
                        <item value="back_top_right"/>
                        <item value="back_bottom_right"/>
                        <item value="back_bottom_left"/>
                    </enumeration>
                </field>
                <field name="x_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing x-axis base vector of the
                         processing_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="y_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing y-axis base vector of the
                         processing_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="z_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing z-axis base vector of the
                         processing_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
            </group>
            <group name="sample_reference_frame" type="NXcoordinate_system" recommended="true">
                <field name="depends_on" type="NX_CHAR" optional="true">
                    <doc>
                         Reference to the specifically named :ref:`NXsample` instance(s) for
                         which these conventions apply (e.g. /entry1/sample1).
                    </doc>
                </field>
                <field name="alias" type="NX_CHAR" optional="true"/>
                <field name="type" type="NX_CHAR"/>
                <field name="handedness" type="NX_CHAR"/>
                <field name="origin" type="NX_CHAR" recommended="true">
                    <doc>
                         Location of the origin of the sample_reference_frame.
                         
                         It is assumed that regions-of-interest in this reference frame form a rectangle or cuboid.
                         Edges are interpreted by inspecting the direction of their outer unit normals
                         (which point either parallel or antiparallel) along respective base vector direction
                         of the reference frame.
                         
                         If any of these assumptions is not met, the user is required to explicitly state this.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="front_top_left"/>
                        <item value="front_top_right"/>
                        <item value="front_bottom_right"/>
                        <item value="front_bottom_left"/>
                        <item value="back_top_left"/>
                        <item value="back_top_right"/>
                        <item value="back_bottom_right"/>
                        <item value="back_bottom_left"/>
                    </enumeration>
                </field>
                <field name="x_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing x-axis base vector of the
                         sample_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="y_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing y-axis base vector of the
                         sample_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="z_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing z-axis base vector of the
                         sample_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
            </group>
            <group name="detector_reference_frameID" type="NXcoordinate_system" minOccurs="0" maxOccurs="unbounded">
                <field name="depends_on" type="NX_CHAR" optional="true">
                    <doc>
                         Reference to the specifically named :ref:`NXdetector` instance for
                         which these conventions apply (e.g. /entry1/instrument/detector1).
                    </doc>
                </field>
                <field name="alias" type="NX_CHAR" optional="true"/>
                <field name="type" type="NX_CHAR"/>
                <field name="handedness" type="NX_CHAR"/>
                <field name="origin" type="NX_CHAR" recommended="true">
                    <doc>
                         Location of the origin of the detector_reference_frame.
                         
                         If the regions-of-interest forms a rectangle or cuboid, it is assumed that edges are interpreted
                         by inspecting the direction of their outer unit normals (which point either parallel or antiparallel)
                         along respective base vector direction of the reference frame.
                         
                         If any of these assumptions is not met, the user is required to explicitly state this.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="front_top_left"/>
                        <item value="front_top_right"/>
                        <item value="front_bottom_right"/>
                        <item value="front_bottom_left"/>
                        <item value="back_top_left"/>
                        <item value="back_top_right"/>
                        <item value="back_bottom_right"/>
                        <item value="back_bottom_left"/>
                    </enumeration>
                </field>
                <field name="x_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing x-axis base vector of the
                         detector_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="y_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing y-axis base vector of the
                         detector_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
                <field name="z_direction" type="NX_CHAR" recommended="true">
                    <doc>
                         Direction of the positively pointing z-axis base vector of the
                         detector_reference_frame.
                    </doc>
                    <enumeration>
                        <item value="undefined"/>
                        <item value="north"/>
                        <item value="east"/>
                        <item value="south"/>
                        <item value="west"/>
                        <item value="in"/>
                        <item value="out"/>
                    </enumeration>
                </field>
            </group>
        </group>
        <!--the description can be so lean because we do not need to overwrite here s.th. as everything is defined already
we just say we compose using the base class NXcoordinate_system-->
        <group name="measurement" type="NXem_msr" optional="true">
            <group name="em_lab" type="NXinstrument">
                <field name="instrument_name" type="NX_CHAR" recommended="true"/>
                <field name="location" type="NX_CHAR" recommended="true"/>
                <group name="fabrication" type="NXfabrication" optional="true">
                    <field name="vendor" type="NX_CHAR"/>
                    <field name="model" type="NX_CHAR"/>
                    <group name="identifier" type="NXidentifier" recommended="true"/>
                </group>
                <group name="control_programID" type="NXprogram" minOccurs="1" maxOccurs="unbounded">
                    <doc>
                         Details about the control program used for operating the microscope.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <attribute name="version" type="NX_CHAR"/>
                    </field>
                </group>
                <group name="ebeam_column" type="NXebeam_column">
                    <group name="chamber" type="NXchamber" optional="true"/>
                    <group name="fabrication" type="NXfabrication" optional="true">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                        <group name="identifier" type="NXidentifier" recommended="true"/>
                    </group>
                    <group name="electron_source" type="NXsource">
                        <doc>
                             This concept is related to term `Source`_ of the EMglossary standard.
                             
                             .. _Source: https://purls.helmholtz-metadaten.de/emg/EMG_00000045
                        </doc>
                        <field name="emitter_type" type="NX_CHAR"/>
                        <field name="probe" type="NX_CHAR"/>
                        <!--voltage like all other dynamic quantities should better be placed in instances of NXevent_data_em-->
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <!--fabrication is an example which shows when one needs to specify in the appdef if some of the
inherited objects from NXebeam_column have to be specified that is when one wishes to document
e.g. a combination of cardinality constraints or concept symbol constraints
i.e. use NXfabrication from NXsource but demand it to be labelled with the symbol fabrication
likewise if you provide fabrication details you need to provide vendor and model but not necessarily identifier-->
                    <group name="lensID" type="NXlens_em" minOccurs="0" maxOccurs="unbounded">
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="apertureID" type="NXaperture" minOccurs="0" maxOccurs="unbounded">
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="monochromatorID" type="NXmonochromator" minOccurs="0" maxOccurs="unbounded">
                        <doc>
                             Device for improving energy resolution or reducing chromatic aberration.
                             
                             Examples are Wien, $\textalpha$-, or $\Omega$- energy filter or `cc corrector
                             like &lt;https://www.ceos-gmbh.de/en/basics/cc-corrector&gt;`_
                        </doc>
                        <!--user perspective-->
                        <field name="type" type="NX_CHAR">
                            <doc>
                                 Qualitative type of the component.
                            </doc>
                            <enumeration>
                                <item value="wien"/>
                                <item value="alfa"/>
                                <item value="omega"/>
                                <item value="castaing_henry"/>
                                <item value="gatan_imaging"/>
                                <item value="sector_analyzer"/>
                            </enumeration>
                        </field>
                        <!--control level perspective
technical design perspective-->
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="corrector_cs" type="NXcorrector_cs" minOccurs="0" maxOccurs="1">
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="corrector_ax" type="NXcomponent" minOccurs="0" maxOccurs="1">
                        <doc>
                             Device reshaping an ellipse-shaped electron beam to a circular one.
                             
                             * `L. Reimer 1998, Springer, 1998 &lt;https://dx.doi.org/10.1007/978-3-540-3896&gt;`_
                             * `M. Tanaka et al., Electron Microscopy Glossary, 2024 &lt;https://www.jeol.com/words/semterms/20201020.111014.php#gsc.tab=0&gt;`_
                             
                             Stigmator is an exact synonym.
                        </doc>
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="biprism" type="NXcomponent" optional="true">
                        <doc>
                             Electron biprism as it is used e.g. for electron holography.
                        </doc>
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <!--
contributed definition NXwaveplate is a closely related concept but may fit even better but waveplate
has been defined from the perspective of classical optics
same challenge like with NXlens and NXlens_em, an electrostatic lens is not the same concept
like it is an glass lens (i.e. optical) NXlens
but both concepts have in common that they can be assumed to be specialization of a super class
lenses i.e. devices which can affect the pathes of beams
-->
                    <group name="phaseplateID" type="NXcomponent" minOccurs="0" maxOccurs="unbounded">
                        <doc>
                             Device that causes a change in the phase of an electron wave.
                             
                             * `M. Malac et al. &lt;https://doi.org/10.1093/jmicro/dfaa070&gt;`_
                             * `R. R. Schröder et al. &lt;https://www.lem.kit.edu/152.php&gt;`_
                        </doc>
                        <field name="type" type="NX_CHAR">
                            <doc>
                                 Qualitative type
                            </doc>
                            <enumeration>
                                <item value="thin_film"/>
                                <item value="electrostatic"/>
                            </enumeration>
                        </field>
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="sensorID" type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                    <group name="actuatorID" type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                </group>
                <group name="ibeam_column" type="NXibeam_column" minOccurs="0" maxOccurs="1">
                    <!--there are tri-beam SEMs but they typically use a laser for which we should have an own base class-->
                    <group name="chamber" type="NXchamber" optional="true"/>
                    <group name="fabrication" type="NXfabrication" optional="true">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                        <group name="identifier" type="NXidentifier" recommended="true"/>
                    </group>
                    <group name="ion_source" type="NXsource">
                        <group name="probe" type="NXion"/>
                    </group>
                    <group name="lensID" type="NXlens_em" minOccurs="0" maxOccurs="unbounded">
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="apertureID" type="NXaperture" minOccurs="0" maxOccurs="unbounded">
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <group name="monochromatorID" type="NXmonochromator" minOccurs="0" maxOccurs="unbounded">
                        <doc>
                             Device for improving energy resolution or reducing chromatic aberration.
                             
                             Examples are Wien, $\textalpha$-, or $\Omega$- energy filter or `cc corrector
                             like &lt;https://www.ceos-gmbh.de/en/basics/cc-corrector&gt;`_
                        </doc>
                        <field name="type" type="NX_CHAR">
                            <doc>
                                 Qualitative type of the component.
                            </doc>
                            <enumeration>
                                <item value="wien"/>
                                <item value="alfa"/>
                                <item value="omega"/>
                                <item value="castaing_henry"/>
                                <item value="gatan_imaging"/>
                                <item value="sector_analyzer"/>
                            </enumeration>
                        </field>
                        <group name="fabrication" type="NXfabrication" optional="true">
                            <field name="vendor" type="NX_CHAR"/>
                            <field name="model" type="NX_CHAR"/>
                            <group name="identifier" type="NXidentifier" recommended="true"/>
                        </group>
                    </group>
                    <!--device for correcting axial astigmatism of ion beam?-->
                    <group name="sensorID" type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                    <group name="actuatorID" type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                </group>
                <group name="detectorID" type="NXdetector" minOccurs="0" maxOccurs="unbounded">
                    <group name="fabrication" type="NXfabrication">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                    </group>
                </group>
                <!--identifier(NXidentifier):   # only relevant when deprecating serial_number
  exists: recommended-->
                <group name="scan_controller" type="NXscanbox_em" optional="true">
                    <group name="fabrication" type="NXfabrication" optional="true">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                        <group name="identifier" type="NXidentifier" recommended="true"/>
                    </group>
                </group>
                <group type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                <group type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                <group type="NXstage_lab" minOccurs="0" maxOccurs="unbounded">
                    <group name="fabrication" type="NXfabrication" optional="true">
                        <field name="vendor" type="NX_CHAR"/>
                        <field name="model" type="NX_CHAR"/>
                        <group name="identifier" type="NXidentifier" recommended="true"/>
                    </group>
                </group>
                <group type="NXchamber" minOccurs="0" maxOccurs="unbounded"/>
                <group type="NXpump" minOccurs="0" maxOccurs="unbounded"/>
            </group>
            <group name="event_data_em_set" type="NXevent_data_em_set" minOccurs="0" maxOccurs="1">
                <!--an instance must not have an NXevent_data_em_set but if it has one it must not be more than 1 !-->
                <group type="NXevent_data_em" minOccurs="0" maxOccurs="unbounded">
                    <field name="start_time" type="NX_DATE_TIME" recommended="true"/>
                    <field name="end_time" type="NX_DATE_TIME" recommended="true"/>
                    <group type="NXimage_set" minOccurs="0" maxOccurs="unbounded">
                        <group type="NXprocess">
                            <group name="source" type="NXserialized" recommended="true">
                                <field name="type" type="NX_CHAR"/>
                                <field name="path" type="NX_CHAR"/>
                                <field name="checksum" type="NX_CHAR"/>
                                <field name="algorithm" type="NX_CHAR"/>
                                <field name="absolute_path" type="NX_CHAR" recommended="true"/>
                            </group>
                            <field name="detector_identifier" type="NX_CHAR"/>
                        </group>
                        <group name="image_1d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_COMPLEX" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_2d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_COMPLEX" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="image_3d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_COMPLEX" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_1d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="group_identifier" type="NX_INT" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_2d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="group_identifier" type="NX_INT" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_3d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="real" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="imag" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="magnitude" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="intensity" type="NX_NUMBER" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="group_identifier" type="NX_INT" optional="true">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="image_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                    <group type="NXspectrum_set" minOccurs="0" maxOccurs="unbounded">
                        <group type="NXprocess">
                            <group name="source" type="NXserialized" recommended="true">
                                <field name="type" type="NX_CHAR"/>
                                <field name="path" type="NX_CHAR"/>
                                <field name="checksum" type="NX_CHAR"/>
                                <field name="algorithm" type="NX_CHAR"/>
                                <field name="absolute_path" type="NX_CHAR" recommended="true"/>
                            </group>
                            <field name="detector_identifier" type="NX_CHAR"/>
                        </group>
                        <group name="spectrum_0d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_1d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_2d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="spectrum_3d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_0d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="spectrum_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_1d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="spectrum_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_2d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="spectrum_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                        <group name="stack_3d" type="NXdata" optional="true">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_INT"/>
                            <field name="title" type="NX_CHAR"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="spectrum_identifier" type="NX_INT">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_k" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                            <field name="axis_energy" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                    <group name="em_lab" type="NXinstrument" recommended="true">
                        <group name="ebeam_column" type="NXebeam_column">
                            <field name="operation_mode" type="NX_CHAR"/>
                            <group name="electron_source" type="NXsource">
                                <doc>
                                     This concept is related to term `Source`_ of the EMglossary standard.
                                     
                                     .. _Source: https://purls.helmholtz-metadaten.de/emg/EMG_00000045
                                </doc>
                                <field name="voltage" type="NX_NUMBER">
                                    <doc>
                                         The potential difference between anode and cathode.
                                         
                                         This concept is related to term `Acceleration Voltage`_ of the EMglossary standard.
                                         
                                         .. _Acceleration Voltage: https://purls.helmholtz-metadaten.de/emg/EMG_00000004
                                    </doc>
                                </field>
                                <field name="extraction_voltage" type="NX_NUMBER" optional="true" units="NX_VOLTAGE">
                                    <doc>
                                         Voltage which is utilised to create an electric field that draws particles from
                                         the source.
                                         
                                         This concept is related to term `Extraction Voltage`_ of the EMglossary standard.
                                         
                                         .. _Extraction Voltage: https://purls.helmholtz-metadaten.de/emg/EMG_00000025
                                    </doc>
                                </field>
                                <field name="emission_current" type="NX_NUMBER" optional="true" units="NX_CURRENT">
                                    <doc>
                                         Electrical current which is released from the source.
                                         
                                         This concept is related to term `Emission Current`_ of the EMglossary standard.
                                         
                                         .. _Emission Current: https://purls.helmholtz-metadaten.de/emg/EMG_00000025
                                    </doc>
                                </field>
                                <field name="filament_current" type="NX_NUMBER" optional="true" units="NX_CURRENT">
                                    <doc>
                                         Electrical current which flows through the source.
                                         
                                         This concept is related to term `Filament Current`_ of the EMglossary standard.
                                         
                                         .. _Filament Current: https://purls.helmholtz-metadaten.de/emg/EMG_00000027
                                    </doc>
                                </field>
                            </group>
                            <group name="lensID" type="NXlens_em" minOccurs="0" maxOccurs="unbounded">
                                <field name="value" type="NX_NUMBER"/>
                            </group>
                            <group name="apertureID" type="NXaperture" minOccurs="0" maxOccurs="unbounded">
                                <field name="value" type="NX_NUMBER" units="NX_ANY">
                                    <doc>
                                         Relevant value from the control software.
                                         
                                         This is not always just the diameter of the aperture (not even in the case)
                                         of a circular aperture. Usually, it is a value that is set in the control
                                         software whereby a specific configuration of an aperture is selected by the
                                         software.
                                         
                                         The control software of commercial microscope typically offers the user
                                         access at a high abstraction level because of which many details about
                                         the actual settings of the electrical components are typically unknown.
                                         
                                         However, if more details are known or should be documented one should
                                         use the description field for this.
                                    </doc>
                                </field>
                            </group>
                            <group name="monochromatorID" type="NXmonochromator" minOccurs="0" maxOccurs="unbounded">
                                <doc>
                                     Device to improve energy resolution or chromatic aberration.
                                     
                                     Examples are Wien, $\textalpha$-, or $\Omega$- energy filter or `cc corrector
                                     like &lt;https://www.ceos-gmbh.de/en/basics/cc-corrector&gt;`_
                                </doc>
                                <!--user perspective-->
                                <field name="applied" type="NX_BOOLEAN">
                                    <doc>
                                         Was the corrector used?
                                    </doc>
                                </field>
                                <!--control level perspective
technical components of the corrector-->
                                <field name="dispersion" type="NX_NUMBER" recommended="true" units="NX_ANY">
                                    <doc>
                                         Energy dispersion in e.g. µm/eV.
                                    </doc>
                                </field>
                                <field name="voltage" type="NX_NUMBER" recommended="true" units="NX_VOLTAGE">
                                    <doc>
                                         Corresponding voltage for that energy dispersion.
                                    </doc>
                                </field>
                            </group>
                            <group name="corrector_cs" type="NXcorrector_cs" minOccurs="0" maxOccurs="1">
                                <field name="applied" type="NX_BOOLEAN" recommended="true"/>
                                <group name="tableauID" type="NXprocess" minOccurs="1" maxOccurs="unbounded">
                                    <!--model(NX_CHAR):
 exists: optional
ceos-->
                                    <group name="c_1" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="a_1" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="b_2" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="a_2" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="s_3" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="a_3" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="b_4" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="d_4" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="a_4" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="s_5" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="r_5" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="a_6" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <!--nion-->
                                    <group name="c_1_0" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_1_2_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_1_2_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_2_1_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_2_1_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_2_3_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_2_3_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3_0" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3_2_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3_2_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3_4_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_3_4_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_1_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_1_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_3_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_3_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_5_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_4_5_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_0" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_2_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_2_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_4_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_4_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_6_a" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                    <group name="c_5_6_b" type="NXaberration" optional="true">
                                        <field name="magnitude" type="NX_NUMBER"/>
                                    </group>
                                </group>
                            </group>
                            <!--we could write down how to store the aberrations but we should not force to add aberrations
basically optional use of NXaberration therein at least some value required-->
                            <group name="corrector_ax" type="NXcomponent" minOccurs="0" maxOccurs="1">
                                <doc>
                                     Device reshaping an ellipse-shaped electron beam to a circular one.
                                     
                                     * `L. Reimer 1998, Springer, 1998 &lt;https://dx.doi.org/10.1007/978-3-540-3896&gt;`_
                                     * `M. Tanaka et al., Electron Microscopy Glossary, 2024 &lt;https://www.jeol.com/words/semterms/20201020.111014.php#gsc.tab=0&gt;`_
                                     
                                     Stigmator is an exact synonym.
                                </doc>
                                <field name="applied" type="NX_BOOLEAN">
                                    <doc>
                                         Was the corrector used?
                                    </doc>
                                </field>
                                <field name="value_x" type="NX_NUMBER" units="NX_ANY">
                                    <doc>
                                         Descriptor for the correction strength along the first direction when exact technical details
                                         are unknown or not directly controllable as the control software of the microscope does not
                                         enable or was not configured to display these values (for end users).
                                    </doc>
                                </field>
                                <field name="value_y" type="NX_NUMBER" units="NX_ANY">
                                    <doc>
                                         Descriptor for the correction strength along the second direction when exact technical details
                                         are unknown or not directly controllable as the control software of the microscope does not
                                         enable or was not configured to display these values (for end users).
                                    </doc>
                                </field>
                            </group>
                            <group name="biprism" type="NXcomponent" minOccurs="0" maxOccurs="1"/>
                            <group name="phaseplateID" type="NXcomponent" minOccurs="0" maxOccurs="unbounded"/>
                            <group name="sensorID" type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                            <group name="actuatorID" type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                            <group type="NXbeam" minOccurs="0" maxOccurs="unbounded">
                                <doc>
                                     This concept is related to term `Electron Beam`_ of the EMglossary standard.
                                     
                                     .. _Electron Beam: https://purls.helmholtz-metadaten.de/emg/EMG_00000021
                                </doc>
                            </group>
                        </group>
                        <group name="ibeam_column" type="NXibeam_column" minOccurs="0" maxOccurs="1">
                            <group name="ion_source" type="NXsource">
                                <group name="probe" type="NXion"/>
                                <field name="voltage" type="NX_NUMBER"/>
                            </group>
                            <group name="lensID" type="NXlens_em" minOccurs="0" maxOccurs="unbounded">
                                <field name="value" type="NX_NUMBER"/>
                            </group>
                            <group name="apertureID" type="NXaperture" minOccurs="0" maxOccurs="unbounded">
                                <field name="value" type="NX_NUMBER" units="NX_ANY">
                                    <doc>
                                         Relevant value from the control software.
                                         
                                         This is not always just the diameter of the aperture (not even in the case)
                                         of a circular aperture. Usually, it is a value that is set in the control
                                         software whereby a specific configuration of an aperture is selected by the
                                         software.
                                         
                                         The control software of commercial microscope typically offers the user
                                         access at a high abstraction level because of which many details about
                                         the actual settings of the electrical components are typically unknown.
                                         
                                         However, if more details are known or should be documented one should
                                         use the description field for this.
                                    </doc>
                                </field>
                            </group>
                            <group name="monochromatorID" type="NXmonochromator" minOccurs="0" maxOccurs="unbounded">
                                <field name="applied" type="NX_BOOLEAN"/>
                            </group>
                            <group name="sensorID" type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                            <group name="actuatorID" type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                            <group type="NXbeam" minOccurs="0" maxOccurs="unbounded"/>
                        </group>
                        <group name="detectorID" type="NXdetector" minOccurs="0" maxOccurs="unbounded">
                            <field name="mode" type="NX_CHAR"/>
                        </group>
                        <group name="scan_controller" type="NXscanbox_em" optional="true">
                            <field name="scan_schema" type="NX_CHAR"/>
                            <field name="dwell_time" type="NX_NUMBER"/>
                        </group>
                        <group type="NXsensor" minOccurs="0" maxOccurs="unbounded"/>
                        <group type="NXactuator" minOccurs="0" maxOccurs="unbounded"/>
                        <group name="heater" type="NXactuator" optional="true">
                            <field name="current" type="NX_NUMBER" units="NX_CURRENT">
                                <doc>
                                     Nominal current of the heater.
                                </doc>
                            </field>
                            <field name="voltage" type="NX_NUMBER" units="NX_VOLTAGE">
                                <doc>
                                     Nominal voltage of the heater.
                                </doc>
                            </field>
                            <field name="power" type="NX_NUMBER" units="NX_POWER">
                                <doc>
                                     Nominal power of the heater.
                                </doc>
                            </field>
                        </group>
                        <group type="NXstage_lab" minOccurs="0" maxOccurs="unbounded">
                            <field name="design" type="NX_CHAR" recommended="true"/>
                        </group>
                        <group type="NXchamber" minOccurs="0" maxOccurs="unbounded"/>
                        <group type="NXpump" minOccurs="0" maxOccurs="unbounded"/>
                    </group>
                </group>
            </group>
        </group>
        <group name="simulation" type="NXem_sim" optional="true"/>
        <!--remains to be discussed based on examples-->
        <!--relevant research result post-processed for specific community methods
but normalized in its representation ready to be consumed for a
research data management system-->
        <group name="roiID" type="NXroi" minOccurs="0" maxOccurs="unbounded">
            <doc>
                 A region-of-interest analyzed either during or after the session
                 for which specific processed data are available.
                 
                 This concept is related to term `Region Of Interest`_ of the EMglossary standard.
                 
                 .. _Region Of Interest: https://purls.helmholtz-metadaten.de/emg/EMG_00000042
            </doc>
            <!--as soon as one entry is here constrained further
an RDM can be sure to find specific pieces of information in a
specific way but then every user of this application definition
is required to provide such information in this way!-->
            <group name="imaging" type="NXem_img" optional="true">
                <field name="imaging_mode" type="NX_CHAR"/>
                <group type="NXimage_set" minOccurs="0" maxOccurs="unbounded">
                    <field name="half_angle_interval" type="NX_NUMBER" optional="true"/>
                </group>
            </group>
            <!--microstructureID(NXmicrostructure):
  exists: optional-->
            <group name="ebsd" type="NXem_ebsd" optional="true">
                <!--remains to be discussed based on examples-->
                <group name="gnomonic_reference_frame" type="NXcoordinate_system" optional="true">
                    <field name="alias" type="NX_CHAR" optional="true"/>
                    <field name="type" type="NX_CHAR"/>
                    <field name="handedness" type="NX_CHAR"/>
                    <field name="origin" type="NX_CHAR"/>
                    <field name="x_direction" type="NX_CHAR"/>
                    <field name="y_direction" type="NX_CHAR"/>
                    <field name="z_direction" type="NX_CHAR"/>
                </group>
                <group name="pattern_centre" type="NXprocess" recommended="true">
                    <field name="x_boundary_convention" type="NX_CHAR"/>
                    <field name="x_normalization_direction" type="NX_CHAR"/>
                    <field name="y_boundary_convention" type="NX_CHAR"/>
                    <field name="y_normalization_direction" type="NX_CHAR"/>
                </group>
                <group name="measurement" type="NXprocess" optional="true">
                    <field name="depends_on" type="NX_CHAR"/>
                    <group name="source" type="NXserialized">
                        <field name="type" type="NX_CHAR"/>
                        <field name="path" type="NX_CHAR"/>
                        <field name="checksum" type="NX_CHAR"/>
                        <field name="algorithm" type="NX_CHAR"/>
                    </group>
                </group>
                <group name="simulation" type="NXprocess" optional="true">
                    <field name="depends_on" type="NX_CHAR"/>
                    <group name="source" type="NXserialized">
                        <field name="type" type="NX_CHAR"/>
                        <field name="path" type="NX_CHAR"/>
                        <field name="checksum" type="NX_CHAR"/>
                        <field name="algorithm" type="NX_CHAR"/>
                    </group>
                </group>
                <group name="indexing" type="NXprocess" optional="true">
                    <field name="number_of_scan_points" type="NX_UINT"/>
                    <field name="indexing_rate" type="NX_NUMBER" recommended="true"/>
                    <group name="source" type="NXserialized" optional="true">
                        <field name="type" type="NX_CHAR"/>
                        <field name="path" type="NX_CHAR"/>
                        <field name="checksum" type="NX_CHAR"/>
                        <field name="algorithm" type="NX_CHAR"/>
                    </group>
                    <group name="phaseID" type="NXcrystal_structure" minOccurs="0" maxOccurs="unbounded">
                        <field name="number_of_scan_points" type="NX_UINT"/>
                        <field name="a_b_c" type="NX_NUMBER"/>
                        <field name="alpha_beta_gamma" type="NX_NUMBER"/>
                        <field name="space_group" type="NX_CHAR"/>
                        <field name="phase_identifier" type="NX_INT"/>
                        <field name="phase_name" type="NX_CHAR"/>
                    </group>
                    <!--ipfID(NXmicrostructure_ipf):
  exists: recommended
  projection_direction(NX_NUMBER):
  map(NXdata):
    \@signal(NX_CHAR):
    \@axes(NX_CHAR):
    \@AXISNAME_indices(NX_INT):
    title(NX_CHAR):
    data(NX_NUMBER):
      \@long_name(NX_CHAR):
    axis_x(NX_NUMBER):
      \@long_name(NX_CHAR):
    axis_y(NX_NUMBER):
      exists: optional
      \@long_name(NX_CHAR):
    axis_z(NX_NUMBER):
      exists: optional
      \@long_name(NX_CHAR):
  legend(NXdata):
    \@signal(NX_CHAR):
    \@axes(NX_CHAR):
    \@AXISNAME_indices(NX_INT):
    title(NX_CHAR):
    data(NX_NUMBER):
      \@long_name(NX_CHAR):
    axis_x(NX_NUMBER):
      \@long_name(NX_CHAR):
    axis_y(NX_NUMBER):
      \@long_name(NX_CHAR):-->
                    <group name="roi" type="NXdata" recommended="true">
                        <attribute name="signal" type="NX_CHAR"/>
                        <attribute name="axes" type="NX_CHAR"/>
                        <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                        <field name="title" type="NX_CHAR"/>
                        <field name="descriptor" type="NX_CHAR"/>
                        <field name="data" type="NX_NUMBER"/>
                        <field name="axis_y" type="NX_NUMBER">
                            <attribute name="long_name" type="NX_CHAR"/>
                        </field>
                        <field name="axis_x" type="NX_NUMBER">
                            <attribute name="long_name" type="NX_CHAR"/>
                        </field>
                    </group>
                </group>
            </group>
            <group name="eds" type="NXem_eds" optional="true">
                <!--remains to be discussed based on examples-->
                <group name="indexing" type="NXprocess">
                    <group name="summary" type="NXdata" optional="true">
                        <attribute name="signal" type="NX_CHAR"/>
                        <attribute name="axes" type="NX_CHAR"/>
                        <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                        <field name="title" type="NX_CHAR"/>
                        <field name="intensity" type="NX_NUMBER"/>
                        <field name="axis_energy" type="NX_CHAR">
                            <attribute name="long_name" type="NX_CHAR"/>
                        </field>
                    </group>
                    <field name="atom_types" type="NX_CHAR"/>
                    <group type="NXimage_set" minOccurs="0" maxOccurs="118">
                        <field name="iupac_line_candidates" type="NX_CHAR" recommended="true"/>
                        <field name="energy_range" type="NX_NUMBER"/>
                        <group name="image_2d" type="NXdata">
                            <attribute name="signal" type="NX_CHAR"/>
                            <attribute name="axes" type="NX_CHAR"/>
                            <attribute name="AXISNAME_indices" type="NX_CHAR"/>
                            <field name="title" type="NX_CHAR" optional="true"/>
                            <field name="intensity" type="NX_NUMBER">
                                <attribute name="units" type="NX_CHAR" recommended="true"/>
                            </field>
                            <field name="axis_i" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                                <attribute name="units" type="NX_CHAR"/>
                            </field>
                            <field name="axis_j" type="NX_NUMBER">
                                <attribute name="long_name" type="NX_CHAR"/>
                                <attribute name="units" type="NX_CHAR"/>
                            </field>
                        </group>
                    </group>
                </group>
            </group>
            <group name="eels" type="NXem_eels" optional="true"/>
            <group name="correlation" type="NXem_correlation" optional="true"/>
        </group>
    </group>
    <!--remains to be discussed based on examples-->
    <!--see an example how to map e.g. the following flat schema https://www.zenodo.org/record/6513745 to NXem
in https://github.com/FAIRmat-NFDI/nexus_definitions/commit/0b928c4352bc5636f673b5fb25ce990f1af8a099-->
</definition>
