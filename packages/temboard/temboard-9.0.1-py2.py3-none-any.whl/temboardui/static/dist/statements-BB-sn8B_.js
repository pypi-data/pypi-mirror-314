import{p as u,c as A,q as j,e as m,z as r,V,f as l,g,h as q,k as n,w as o,j as i,S as oe,o as v,N as ne}from"./vue-DqMao7g8.js";import{b as ie,u as ue,c as de,a as ce}from"./vue-router-CCNp7My1.js";import{m as me,O as ve,g as he,B as be,V as pe,C as _e,n as fe,W as L,a as ye,t as ge,U as ke,p as De,b as xe}from"./bootstrap-vue-next-DLtH9VAG.js";import{H as E}from"./highlight.js-CWp04Ajj.js";import{s as we}from"./default-DS69DB32.js";import{$ as Q}from"./jquery-BALIvAru.js";import{_ as T}from"./lodash-uc_7-CSk.js";import{m as k}from"./moment-CMyQs7Vz.js";import{_ as qe}from"./DateRangePicker-CmtuJeio.js";import{f as H}from"./duration-BgSd64Xa.js";import"./daterangepicker-i3LpM03M.js";const Te={class:"row mb-1"},Be={class:"col-12 d-flex justify-content-between"},Ce={"aria-label":"breadcrumb",class:"d-inline-block"},Me={class:"breadcrumb"},Fe={class:"breadcrumb-item"},Ve={key:1},Le={key:0,class:"breadcrumb-item"},He=r("em",{class:"text-body-secondary small"},"Database:",-1),Pe={key:1},Re={key:1,class:"breadcrumb-item"},Se=r("em",{class:"text-body-secondary small"},"Query:",-1),Ue={class:"row mb-1"},Oe={key:0,class:"col d-flex"},je={class:"alert alert-danger"},Ie=oe('<div class="row mb-1"><div class="col-sm-4"><div class="text-center"><strong>Calls</strong></div> <div id="legend-chart1" class="legend-chart"></div> <div id="chart1" style="width:100%;height:150px;"></div></div> <div class="col-sm-4"><div class="text-center"><strong>Time</strong></div> <div id="legend-chart2" class="legend-chart"></div> <div id="chart2" style="width:100%;height:150px;"></div></div> <div class="col-sm-4"><div class="text-center"><strong>Blocks</strong></div> <div id="legend-chart3" class="legend-chart"></div> <div id="chart3" style="width:100%;height:150px;"></div></div></div>',1),Ne={class:"row mb-1"},We={class:"col-6 offset-6"},ze={class:"text-center text-danger my-2"},Ze=r("strong",null,"Loading...",-1),$e=["innerHTML","onClick"],Ae=["onClick"],Ee=["innerHTML"],Qe={key:0},Ke=["innerHTML"],Ge={class:"text-center"},Je=r("br",null,null,-1),Xe={key:0,class:"text-body-secondary"},Ye={key:1,class:"text-body-secondary"},et={key:0,class:"row"},tt={class:"col-6"},at={__name:"Statements",setup(rt){E.registerLanguage("sql",we);const K=ie(),D=ue();let P,R;const x=u([]),y=u(null),S=u(!0),h=u(D.query.dbid),d=u(D.query.queryid),b=u(D.query.userid),U=u(null),G=u("total_exec_time"),w=u(""),B=u(null),C=u(null),O=u(1),M=u(1),I=u(20),N=u(null),J=A(Y),X=A(()=>""+B.value+C.value);j(X,W),j(()=>[h.value,d.value,b.value].join("_"),()=>{const t=T.assign({},D.query);h.value?t.dbid=h.value:delete t.dbid,d.value?(t.queryid=d.value,t.userid=b.value):(delete t.queryid,delete t.userid),K.push({query:t}),W()}),j(D,(t,a)=>{h.value=a.query.dbid,d.value=a.query.queryid,b.value=a.query.userid});function W(){x.value=[];const t=B.value,a=C.value;let e=h.value?"/"+h.value:"";e+=d.value?"/"+d.value:"",e+=b.value?"/"+b.value:"",S.value=!0,P&&P.abort(),P=Q.get(apiUrl+e,{start:F(t),end:F(a),noerror:1},function(_){S.value=!1,U.value=_.datname,x.value=_.data,d.value&&(x.value[0]._showDetails=!0),O.value=x.value.length,y.value=_.metas}),R&&R.abort(),R=Q.get(chartApiUrl+e,{start:F(t),end:F(a),noerror:1},te)}function Y(){const t=[{key:"query",label:"Query",class:"query",sortable:!0,sortDirection:"asc"},{key:"datname",label:"DB",class:"database",sortable:!0,sortDirection:"asc"},{key:"rolname",label:"User",sortable:!0,sortDirection:"asc"},{key:"calls",label:"Calls",class:"text-end",sortable:!0},{key:"total_exec_time",label:"Total",formatter:H,class:"text-end border-start",sortable:!0},{key:"mean_time",label:"AVG",formatter:H,class:"text-end",sortable:!0},{key:"shared_blks_read",label:"Read",class:"text-end border-start",formatter:f,sortable:!0},{key:"shared_blks_hit",label:"Hit",class:"text-end",formatter:f,sortable:!0},{key:"shared_blks_dirtied",label:"Dirt.",class:"text-end",formatter:f,sortable:!0},{key:"shared_blks_written",label:"Writ.",class:"text-end",formatter:f,sortable:!0},{key:"temp_blks_read",label:"Read",class:"text-end border-start",formatter:f,sortable:!0},{key:"temp_blks_written",label:"Writ.",class:"text-end",formatter:f,sortable:!0}];let a=["rolname","query"];return h.value&&(a=["datname"]),T.filter(t,function(e){return a.indexOf(e.key)===-1})}function f(t){t*=8192;const a=["B","KB","MB","GB","TB"];if(t==0)return'<span class="text-body-secondary">0</span>';const e=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.round(t/Math.pow(1024,e),2)+" "+a[e]}function z(t){return E.highlight(t,{language:"sql"}).value}function ee(t){O.value=t.length,M.value=1}function F(t){return new Date(t).toISOString()}function te(t){const a=B.value,e=C.value,_={axisLabelFontSize:10,yLabelWidth:14,includeZero:!0,legend:"always",labelsKMB:!0,gridLineColor:"rgba(128, 128, 128, 0.3)",dateWindow:[new Date(a).getTime(),new Date(e).getTime()],xValueParser:function(s){return k(s).toDate().getTime()},zoomCallback:Z,interactionModel:{mousedown:function(s,p,c){c.initializeMouseDown(s,p,c),s.shiftKey?Dygraph.startPan(s,p,c):Dygraph.startZoom(s,p,c)},mousemove:function(s,p,c){c.isPanning?Dygraph.movePan(s,p,c):c.isZooming&&Dygraph.moveZoom(s,p,c)},mouseup:function(s,p,c){if(c.isPanning){Dygraph.endPan(s,p,c);const $=p.dateWindow_;Z($[0],$[1])}else c.isZooming&&Dygraph.endZoom(s,p,c)}}},se=T.map(t.data,function(s){return[k.unix(s.ts).toDate(),s.calls]});new Dygraph(document.getElementById("chart1"),se,Object.assign({},_,{labels:["time","Queries per sec"],labelsDiv:"legend-chart1"}));const le=T.map(t.data,function(s){return[k.unix(s.ts).toDate(),s.load,s.avg_runtime]});new Dygraph(document.getElementById("chart2"),le,Object.assign({},_,{labels:["time","Total","Avg"],labelsDiv:"legend-chart2",axes:{y:{valueFormatter:H,axisLabelFormatter:H}}}));const re=T.map(t.data,function(s){return[k.unix(s.ts).toDate(),s.total_blks_hit,s.total_blks_read]});new Dygraph(document.getElementById("chart3"),re,Object.assign({},_,{labels:["time","Hit /s","Read /s"],labelsDiv:"legend-chart3",axes:{y:{valueFormatter:f,axisLabelFormatter:f}}}))}function Z(t,a){N.value.setFromTo(k(t),k(a))}function ae(t,a){B.value=t,C.value=a}return(t,a)=>(v(),m("div",null,[r("div",Te,[r("div",Be,[r("nav",Ce,[r("ol",Me,[r("li",Fe,[h.value?(v(),m("a",{key:0,href:"",onClick:a[0]||(a[0]=V(e=>{h.value=null,d.value=null,b.value=null},["prevent"]))},`
                All Databases
              `)):(v(),m("span",Ve,"All Databases"))]),l(),h.value?(v(),m("li",Le,[He,l(),d.value&&b.value?(v(),m("a",{key:0,href:"",onClick:a[1]||(a[1]=V(e=>{d.value=null,b.value=null},["prevent"]))},g(U.value),1)):(v(),m("strong",Pe,g(U.value),1))])):q("",!0),l(),d.value&&b.value?(v(),m("li",Re,[Se,l(),r("strong",null,g(d.value),1)])):q("",!0)])]),l(),n(qe,{onFromtoUpdated:ae,ref_key:"dateRangePickerEl",ref:N},null,512)])]),l(),r("div",Ue,[y.value&&y.value.error?(v(),m("div",Oe,[r("p",je,g(y.value.error),1)])):q("",!0)]),l(),Ie,l(),r("div",Ne,[r("div",We,[n(i(pe),{label:"Filter","label-cols-sm":"3","label-align-sm":"right","label-for":"filterInput",class:"mb-0"},{default:o(()=>[n(i(me),null,{default:o(()=>[n(i(ve),{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value=e),type:"search",id:"filterInput",placeholder:"Type to Search"},null,8,["modelValue"]),l(),n(i(he),null,{default:o(()=>[n(i(be),{id:"buttonClearFilter",disabled:!w.value,onClick:a[3]||(a[3]=e=>w.value="")},{default:o(()=>[l("Clear")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})])]),l(),n(i(De),{striped:"",small:"",items:x.value,fields:J.value,"sort-by":G.value,busy:S.value,"current-page":M.value,"per-page":I.value,"sort-desc":"","show-empty":"",filter:w.value,onFiltered:ee,class:"table-query"},{"table-busy":o(()=>[r("div",ze,[n(i(_e),{class:"align-middle"}),l(),Ze])]),"thead-top":o(e=>[n(i(fe),null,{default:o(()=>[n(i(L),{colspan:h.value?3:2},null,8,["colspan"]),l(),n(i(L),{class:"text-center border-start",colspan:"2"},{default:o(()=>[l("Time")]),_:1}),l(),n(i(L),{class:"text-center border-start",colspan:"4"},{default:o(()=>[l("Shared Blocks")]),_:1}),l(),n(i(L),{class:"text-center border-start",colspan:"2"},{default:o(()=>[l("Temp Blocks")]),_:1})]),_:1})]),"cell(query)":o(e=>[r("pre",{class:"sql hljs",innerHTML:z(e.value),onClick:V(_=>{d.value=e.item.queryid,b.value=e.item.userid},["prevent"])},null,8,$e)]),"cell(datname)":o(e=>[r("a",{href:"",onClick:V(_=>h.value=e.item.dbid,["prevent"])},g(e.item.datname),9,Ae)]),"row-details":o(e=>[n(i(ye),{class:"detail"},{default:o(()=>[n(i(ge),{class:"mb-2"},{default:o(()=>[n(i(ke),null,{default:o(()=>[r("pre",{class:"sql hljs",innerHTML:z(e.item.query)},null,8,Ee)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"cell()":o(e=>[typeof e.value=="number"?(v(),m("span",Qe,g(e.value.toFixed(e.value%1?3:0)),1)):(v(),m("span",{key:1,innerHTML:e.value},null,8,Ke))]),empty:o(e=>[r("div",Ge,[l(`
          There are no records to show.
          `),Je,l(),!y.value||y.value.coalesce_seq<2?(v(),m("span",Xe,"No snapshot has been done yet, please wait.")):y.value.error?(v(),m("span",Ye,"There are errors")):q("",!0)])]),_:1},8,["items","fields","sort-by","busy","current-page","per-page","filter"]),l(),!d.value&&!b.value?(v(),m("div",et,[r("div",tt,[n(i(xe),{modelValue:M.value,"onUpdate:modelValue":a[4]||(a[4]=e=>M.value=e),"total-rows":O.value,"per-page":I.value,align:"fill",size:"sm",class:"my-0"},null,8,["modelValue","total-rows","per-page"])])])):q("",!0)]))}},st={template:""},lt=de({history:ce(),routes:[{path:"/:pathMatch(.*)*",name:"not-found",component:st}]});ne({components:{statements:at}}).use(lt).mount("#app");
