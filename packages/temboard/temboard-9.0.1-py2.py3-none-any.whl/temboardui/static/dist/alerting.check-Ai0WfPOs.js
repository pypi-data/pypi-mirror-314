import{p as v,J as z,q as B,s as K,o as b,e as g,c as q,M as G,z as e,f as s,g as C,k as P,n as U,F as x,h as D,A as J,N as $}from"./vue-DqMao7g8.js";import{c as H,a as X}from"./vue-router-CCNp7My1.js";import{$ as c}from"./jquery-BALIvAru.js";import{P as Q}from"./bootstrap.esm-BOBBXxos.js";import{m as E}from"./moment-CMyQs7Vz.js";import{_ as Y}from"./DateRangePicker-CmtuJeio.js";import"./highlight.js-CWp04Ajj.js";import"./daterangepicker-i3LpM03M.js";import"./lodash-uc_7-CSk.js";const ee={__name:"AlertingChart",props:["check","key_","valueType","from","to"],setup(M){const r=M,k=v(null);let u;const T=z("setFromTo");B(()=>""+r.from+r.to,w),K(w);function w(){const t=r.from,a=r.to,i={axisLabelFontSize:10,yLabelWidth:14,ylabel:r.valueType=="percent"?"%":"",includeZero:!0,legend:"always",labelsDiv:"legend"+r.key_,gridLineColor:"rgba(128, 128, 128, 0.3)",dateWindow:[new Date(t).getTime(),new Date(a).getTime()],xValueParser:function(o){return E(o).toDate().getTime()},stackedGraph:!0,zoomCallback:j,interactionModel:{mousedown:function(o,l,n){n.initializeMouseDown(o,l,n),o.shiftKey?Dygraph.startPan(o,l,n):Dygraph.startZoom(o,l,n)},mousemove:function(o,l,n){n.isPanning?Dygraph.movePan(o,l,n):n.isZooming&&Dygraph.moveZoom(o,l,n)},mouseup:function(o,l,n){if(n.isPanning){Dygraph.endPan(o,l,n);const p=l.dateWindow_;j(p[0],p[1])}else n.isZooming&&Dygraph.endZoom(o,l,n)}}};switch(r.valueType){case"percent":i.valueRange=[0,105];break;case"memory":i.labelsKMG2=!0;break}let d=apiUrl+"/../monitoring/data/"+r.check+"?";d+=c.param({key:r.key_,start:y(t),end:y(a)}),u?u.updateOptions({dateWindow:[t,a],file:d}):u=new Dygraph(k.value,d,i),u.ready(function(){c.when(A(r.check,r.key_,t,a),m(r.check,t,a)).done(function(o,l){const n=o[0].reverse();F(n);const p=l[0].reverse();u.updateOptions({underlayCallback:function(f,S){I(p,f),L(n,f,S)}})}).fail(function(){console.error("Something went wrong")})})}function I(t,a){t.forEach(function(i,d){d!=t.length-1&&["warning","critical"].forEach(function(o){const l=i[o],n=u.toDomCoords(new Date(i.datetime),l),p=u.toDomCoords(new Date(t[d+1].datetime),l);a.beginPath(),a.strokeStyle=_[o],i.enabled||a.setLineDash([5,5]),a.moveTo(n[0],n[1]),a.lineTo(p[0],p[1]),a.stroke(),a.setLineDash([]),a.closePath()})})}function F(t){const a=t.map(function(i){const d=N(i.datetime);let o=['<span class="badge text-bg-',i.state.toLowerCase(),'">',i.state,"</span><br>"];return(i.state=="WARNING"||i.state=="CRITICAL")&&(o=o.concat([i.value," > ",i[i.state.toLowerCase()],"<br>"])),o.push(i.datetime),{series:u.getLabels()[1],x:d,shortText:"♥",cssClass:"alert-"+i.state.toLowerCase(),text:o.join(""),tickColor:h[i.state.toLowerCase()],attachAtBottom:!0}});u.setAnnotations(a),window.setTimeout(function(){c(".dygraph-annotation").each(function(){c(this).attr("data-bs-content",c(this).attr("title")),c(this).attr("title","")}),[...document.querySelectorAll(".dygraph-annotation")].map(d=>new Q(d,{trigger:"hover",placement:"top",html:!0}))},1)}function L(t,a,i){t.forEach(function(d,o){if(d.state=="OK")return;const l=u.toDomCoords(new Date(d.datetime),0);let n;if(o==t.length-1){const S=u.numRows();n=u.getValue(S-1,0)}else n=new Date(t[o+1].datetime);const p=u.toDomCoords(n,10);let f=l[0];n=p[0],a.fillStyle=h[d.state.toLowerCase()],a.fillRect(f,i.y,n-f,i.h)})}function m(t,a,i){let d=apiUrl+"/check_changes/"+t+".json";const o={start:y(a),end:y(i),noerror:1};return d+="?"+c.param(o),c.ajax({url:d})}const _={ok:"green",warning:"orange",critical:"red",undef:"#ccc"},h={ok:"green",warning:"rgba(255, 120, 0, .2)",critical:"rgba(255, 0, 0, .2)",undef:"rgba(192, 192, 192, .2)"};function A(t,a,i,d){let o=apiUrl+"/state_changes/"+t+".json";const l={key:a,start:y(i),end:y(d),noerror:1};return o+="?"+c.param(l),c.ajax({url:o})}function N(t){if(u.getRowForX(t))return t;const a=u.numRows();let i=1/0;const d=new Date(t).getTime();let o=t,l,n=0;const p=a-1;let f;for(n;n<p;n++)l=u.getValue(n,0),f=Math.abs(l-d),i>f&&(i=f,o=l);return o}function y(t){return new Date(t).toISOString()}c("#submitFormUpdateCheck").click(function(){c("#updateForm").submit()}),c("#updateForm").submit(function(t){t.preventDefault(),W()});function W(){c.ajax({url:apiUrl+"/checks.json",method:"post",dataType:"json",beforeSend:Z,data:JSON.stringify({checks:[{name:r.check,description:c("#descriptionInput").val(),warning:parseFloat(c("#warningThresholdInput").val()),critical:parseFloat(c("#criticalThresholdInput").val()),enabled:c("#enabledInput").is(":checked")}]}),success:function(){c("#submitFormUpdateCheck").attr("disabled",!0),c("#modalInfo").html('<div class="alert alert-success" role="alert">SUCCESS: Will be taken into account shortly (next check)</div>'),R(),window.setTimeout(function(){window.location.reload()},3e3)},error:function(t){R(),c("#modalInfo").html('<div class="alert alert-danger" role="alert">ERROR: '+V(JSON.parse(t.responseText).error)+"</div>")}})}const O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function V(t){return String(t).replace(/[&<>"'\/]/g,function(a){return O[a]})}function Z(){c("#updateModal .loader").removeClass("d-none")}function R(){c("#updateModal .loader").addClass("d-none")}function j(t,a){T(E(t),E(a))}return(t,a)=>(b(),g("div",{class:"monitoring-chart",ref_key:"chartEl",ref:k},null,512))}},te={id:"check-container"},oe={class:"row mb-3 mb-2"},se={class:"col-12 d-flex justify-content-between"},ae={class:"breadcrumb py-1 mb-0 align-items-center"},ne=e("li",{class:"breadcrumb-item"},[e("a",{href:"../alerting"},"Status")],-1),ie={class:"breadcrumb-item active","aria-current":"page"},re={class:"list-inline small text-body-secondary mb-0"},le={class:"list-inline-item"},ce={class:"list-inline-item"},de=e("span",{class:"text-warning"}," ― ",-1),ue={class:"list-inline-item"},me=e("span",{class:"text-critical"}," ― ",-1),he=e("li",{class:"list-inline-item"},[e("a",{"data-bs-toggle":"modal","data-bs-target":"#updateModal",href:""}," Edit ")],-1),pe={class:"modal fade",id:"updateModal",tabindex:"-1",role:"dialog","aria-labelledby":"updateModalLabel","aria-hidden":"true"},fe={class:"modal-dialog",role:"document"},_e={class:"modal-content"},be=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"updateModalLabel"},"Edit alert"),s(),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ge={class:"modal-body"},ye=e("div",{id:"modalInfo"},null,-1),ve={id:"updateForm"},ke={class:"mb-3"},we=e("label",{for:"descriptionInput",class:"form-label"},"Name",-1),Ce=["value"],Te=e("hr",null,null,-1),De={class:"mb-3 form-check"},Ie=["checked"],Fe=e("label",{class:"form-check-label",for:"enabledInput"},"Enabled",-1),Le=e("small",{class:"form-text text-body-secondary"},`
                    If disabled, no check will be made. Thus no alert will be raised.
                  `,-1),Se={class:"mb-3"},xe=e("label",{for:"warningThresholdInput",class:"form-label"},"Warning threshold",-1),Ee=["value"],Me={class:"mb-3"},Re=e("label",{for:"criticalThresholdInput",class:"form-label"},"Critical threshold",-1),je=["value"],Pe=e("div",{class:"modal-footer"},[e("i",{class:"fa fa-spinner fa-spin loader d-none"}),s(),e("button",{type:"submit",id:"submitFormUpdateCheck",class:"btn btn-success ms-auto"},"Save"),s(),e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancel")],-1),Ue={class:"card w-100 mb-2"},Ae={class:"p-2"},Ne={class:"text-center"},We=["title"],Oe={key:0},Ve={key:1},Ze={class:"card-body pt-0"},ze=["id"],Be=e("div",{class:"row"},[e("div",{class:"col-md-4 col-md-offset-4"},[e("div",{class:"progress"},[e("div",{class:"progress-bar progress-bar-striped",style:{width:"100%"}},"Loading, please wait ...")])])],-1),Ke=[Be],qe={__name:"AlertingCheck",setup(M){const r=v(window.checkInitialData),k=v([]),u=v(null),T=v(null),w=v(null),I=q(()=>k.value.sort(function(m,_){return m.key>_.key}));c.ajax({url:apiUrl+"/states/"+checkInitialData.name+".json",success:function(m){k.value=m},error:function(m){console.error(m)}});function F(m,_){w.value.setFromTo(m,_)}G("setFromTo",F);function L(m,_){u.value=m,T.value=_}return(m,_)=>(b(),g("div",te,[e("div",oe,[e("div",se,[e("ol",ae,[ne,s(),e("li",ie,C(r.value.description),1)]),s(),P(Y,{onFromtoUpdated:L,ref_key:"dateRangePickerEl",ref:w},null,512)])]),s(),e("div",null,[e("ul",re,[e("li",le,[s("Enabled: "),e("i",{class:U(["fa",r.value.enabled?"fa-check":"fa-times"])},null,2)]),s(),e("li",ce,[de,s(`
          Warning: `+C(r.value.warning)+" ",1),r.value.valueType=="percent"?(b(),g(x,{key:0},[s("%")],64)):D("",!0)]),s(),e("li",ue,[me,s(`
          Critical: `+C(r.value.critical)+" ",1),r.value.valueType=="percent"?(b(),g(x,{key:0},[s("%")],64)):D("",!0)]),s(),he]),s(),e("div",pe,[e("div",fe,[e("div",_e,[be,s(),e("div",ge,[ye,s(),e("form",ve,[e("div",ke,[we,s(),e("input",{type:"text",class:"form-control",id:"descriptionInput",value:r.value.description},null,8,Ce)]),s(),Te,s(),e("div",De,[e("input",{type:"checkbox",class:"form-check-input",id:"enabledInput",checked:r.value.enabled},null,8,Ie),s(),Fe,s(),Le]),s(),e("div",Se,[xe,s(),e("input",{type:"text",class:"form-control",id:"warningThresholdInput",value:r.value.warning},null,8,Ee)]),s(),e("div",Me,[Re,s(),e("input",{type:"text",class:"form-control",id:"criticalThresholdInput",value:r.value.critical},null,8,je)])])]),s(),Pe])])])]),s(),(b(!0),g(x,null,J(I.value,h=>(b(),g("div",Ue,[e("div",Ae,[e("div",Ne,[e("i",{class:U("fa fa-heart text-"+h.state.toLowerCase()),"data-bs-toggle":"tooltip",title:"Current status: "+h.state.toLowerCase()},null,10,We),s(` 
          `),h.key!=""?(b(),g("span",Oe,C(h.key),1)):D("",!0),s(),h.key==""?(b(),g("span",Ve,C(r.value.name),1)):D("",!0)])]),s(),e("div",Ze,[e("div",{id:"legend"+h.key,class:"legend-chart"},Ke,8,ze),s(),P(ee,{check:r.value.name,key_:h.key,"value-type":h.value_type,from:u.value,to:T.value},null,8,["check","key_","value-type","from","to"])])]))),256))]))}},Ge={template:""},Je=H({history:X(),routes:[{path:"/:pathMatch(.*)*",name:"not-found",component:Ge}]});$({components:{alertingCheck:qe}}).use(Je).mount("#app");
