import{d as de,e as ee,af as fe,an as pe,ao as te,ap as me,aq as ge,ar as ve,as as ye,at as be,au as _e,av as xe,w as ne,k as n,c as L,g as T,a as H,a8 as ae,h as U,aw as De,ax as ke,o as h,j as _,K as Te,n as M,ay as Re,a6 as R,az as je,aA as Ee,aB as Oe,aC as Se,y as se,q as he,aD as Ie,F as Fe,aE as Ne,aF as Ce}from"./index-CykdlTJ_.js";import{c as w,g as Ve}from"./_commonjsHelpers-Cpj98o6Y.js";import{u as Be}from"./usePageTitle-Dbf9m8gi.js";var Q,re;function Le(){if(re)return Q;re=1;var X="Expected a function",I=NaN,F="[object Symbol]",z=/^\s+|\s+$/g,x=/^[-+]0x[0-9a-f]+$/i,D=/^0b[01]+$/i,m=/^0o[0-7]+$/i,i=parseInt,u=typeof w=="object"&&w&&w.Object===Object&&w,P=typeof self=="object"&&self&&self.Object===Object&&self,W=u||P||Function("return this")(),q=Object.prototype,N=q.toString,j=Math.max,E=Math.min,O=function(){return W.Date.now()};function C(e,a,c){var g,d,t,l,s,f,y=0,o=!1,p=!1,v=!0;if(typeof e!="function")throw new TypeError(X);a=V(a)||0,k(c)&&(o=!!c.leading,p="maxWait"in c,t=p?j(V(c.maxWait)||0,a):t,v="trailing"in c?!!c.trailing:v);function K(r){var b=g,S=d;return g=d=void 0,y=r,l=e.apply(S,b),l}function le(r){return y=r,s=setTimeout(B,a),o?K(r):l}function ie(r){var b=r-f,S=r-y,J=a-b;return p?E(J,t-S):J}function Y(r){var b=r-f,S=r-y;return f===void 0||b>=a||b<0||p&&S>=t}function B(){var r=O();if(Y(r))return Z(r);s=setTimeout(B,ie(r))}function Z(r){return s=void 0,v&&g?K(r):(g=d=void 0,l)}function ue(){s!==void 0&&clearTimeout(s),y=0,g=f=d=s=void 0}function ce(){return s===void 0?l:Z(O())}function G(){var r=O(),b=Y(r);if(g=arguments,d=this,f=r,b){if(s===void 0)return le(f);if(p)return s=setTimeout(B,a),K(f)}return s===void 0&&(s=setTimeout(B,a)),l}return G.cancel=ue,G.flush=ce,G}function k(e){var a=typeof e;return!!e&&(a=="object"||a=="function")}function A(e){return!!e&&typeof e=="object"}function $(e){return typeof e=="symbol"||A(e)&&N.call(e)==F}function V(e){if(typeof e=="number")return e;if($(e))return I;if(k(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=k(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=e.replace(z,"");var c=D.test(e);return c||m.test(e)?i(e.slice(2),c?2:8):x.test(e)?I:+e}return Q=C,Q}var Ue=Le();const Me=Ve(Ue),we={class:"events__content"},ze={class:"events__filters"},Pe={class:"events__controls"},oe=6e4,$e=de({__name:"Events",setup(X){const I=ee(()=>[{text:"Event Feed"}]),F=fe(),{now:z}=pe({interval:oe});Be("Event Feed");const x=te("resource",[]),D=te("events",[]),m=me({type:"span",seconds:-De}),{startDate:i,endDate:u}=ge(),{selectionStart:P,selectionEnd:W}=ve(),q={minRangeInSeconds:Ne-1,maxRangeInSeconds:Ce-1},N=ye(()=>{const{startDate:d,endDate:t}=ae.map("DateRangeSelectValue",m.range,"DateRange"),[l,s]=ke(D.value,v=>v.endsWith("*")),f=l.map(v=>v.replace(".*",".")),o=["prefect.log.write"].filter(v=>!s.includes(v));return{occurred:{since:P.value??d,until:W.value??t},anyResource:{idPrefix:x.value},event:{prefix:f,name:s,excludeName:o}}}),{page:j,pages:E,loading:O,events:C,empty:k}=be(N,{interval:oe}),{margin:A}=_e(),$=()=>({rootMargin:A.value}),{stuck:V}=xe(F,$),e=ee(()=>({chart:{"events__chart--stuck":V.value}}));let a=!1;const c=Me(()=>{if(!(!i.value||!u.value)){if(a){a=!1;return}m.range={type:"range",startDate:i.value,endDate:u.value}}},1e3);ne([i,u],()=>c());function g(){var l,s;if(!m.range)return;const{startDate:d,endDate:t}=ae.map("DateRangeSelectValue",m.range,"DateRange");((l=i.value)==null?void 0:l.getTime())!==d.getTime()&&(a=!0,i.value=d),((s=u.value)==null?void 0:s.getTime())!==t.getTime()&&(a=!0,u.value=t)}return ne(()=>m.range,()=>g()),g(),(d,t)=>{const l=U("p-label"),s=U("p-empty-results"),f=U("p-pager"),y=U("p-layout-default");return n(i)&&n(u)?(h(),L(y,{key:0,class:"events"},{header:T(()=>[_(n(Te),{crumbs:I.value},null,8,["crumbs"])]),default:T(()=>[M("div",we,[M("div",ze,[_(l,{label:"Resource"},{default:T(({id:o})=>[_(n(Re),{id:o,selected:n(x),"onUpdate:selected":t[0]||(t[0]=p=>R(x)?x.value=p:null),multiple:""},null,8,["id","selected"])]),_:1}),_(l,{label:"Events"},{default:T(({id:o})=>[_(n(je),{id:o,selected:n(D),"onUpdate:selected":t[1]||(t[1]=p=>R(D)?D.value=p:null),multiple:""},null,8,["id","selected"])]),_:1})]),M("div",{ref_key:"chart",ref:F,class:Ee(["events__chart p-background",e.value.chart])},[_(n(Oe),{"start-date":n(i),"onUpdate:startDate":t[2]||(t[2]=o=>R(i)?i.value=o:null),"end-date":n(u),"onUpdate:endDate":t[3]||(t[3]=o=>R(u)?u.value=o:null),filter:N.value,"zoom-options":q},null,8,["start-date","end-date","filter"]),M("div",Pe,[_(n(Se),{modelValue:n(m).range,"onUpdate:modelValue":t[4]||(t[4]=o=>n(m).range=o),max:n(z)},null,8,["modelValue","max"])])],2),n(O)&&n(k)?(h(),L(s,{key:0},{message:T(()=>t[7]||(t[7]=[se(" Loading events ")])),_:1})):(h(),he(Fe,{key:1},[n(k)?(h(),L(s,{key:0},{message:T(()=>t[8]||(t[8]=[se(" No events ")])),_:1})):H("",!0),_(n(Ie),{class:"events__timeline",events:n(C),"start-date":n(i),"end-date":n(u)},null,8,["events","start-date","end-date"]),n(C).length?(h(),L(f,{key:1,page:n(j),"onUpdate:page":t[5]||(t[5]=o=>R(j)?j.value=o:null),pages:n(E),"onUpdate:pages":t[6]||(t[6]=o=>R(E)?E.value=o:null),class:"events__pager"},null,8,["page","pages"])):H("",!0)],64))])]),_:1})):H("",!0)}}});export{$e as default};
//# sourceMappingURL=Events-Dc28lSNO.js.map
