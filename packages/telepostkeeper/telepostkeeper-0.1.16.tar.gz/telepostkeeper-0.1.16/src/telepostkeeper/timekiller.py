import subprocess
import time
import argparse
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
logging.basicConfig(
    format='%(asctime)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

def run_subprocess(seconds):
    logger.info('üöÄ Subprocess.call started')

    # –ó–∞–ø—É—Å–∫ main.py –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
    process = subprocess.Popen(['telepostkeeper'])

    # –ü–∞—É–∑–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥
    time.sleep(seconds)

    logger.info('üî´ Subprocess.kill: killing the process')

    # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
    process.kill()

def main():
    # –ü–∞—Ä—Å–µ—Ä –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    parser = argparse.ArgumentParser(description="Run and kill a subprocess after a specified time.")
    parser.add_argument("seconds", type=int, help="Time in seconds before killing the subprocess.")
    args = parser.parse_args()

    # –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    run_subprocess(args.seconds)

if __name__ == "__main__":
    main()