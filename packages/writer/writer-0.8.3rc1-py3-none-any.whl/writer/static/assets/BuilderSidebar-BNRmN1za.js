import{d as M,an as _e,ao as ve,o as a,e as m,f as n,m as j,a4 as ge,C as he,_ as P,i as E,a as V,r as q,c as _,au as ye,av as Y,w as ee,b as D,n as L,F as I,s as X,t as F,Y as te,P as N,ar as we,W as G,J as S,L as Q,x as ke,ap as be,l as Ce,v as Ie,N as oe,u as Se,y as ae,z as ne,q as Z}from"./index-YmO2-Soz.js";const Te={class:"BuilderSidebarPanel"},Be={class:"inputContainer"},$e={class:"main"},De=M({__name:"BuilderSidebarPanel",props:_e({placeholder:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const v=ve(u,"modelValue");return(s,p)=>(a(),m("div",Te,[n("div",Be,[j(ge,{modelValue:v.value,"onUpdate:modelValue":p[0]||(p[0]=i=>v.value=i),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:s.placeholder},null,8,["modelValue","placeholder"])]),n("div",$e,[he(s.$slots,"default",{},void 0,!0)])]))}}),se=P(De,[["__scopeId","data-v-9ab52e2b"]]),Ee={class:"header"},Ve={class:"tools"},xe=["data-writer-tooltip","data-component-type","onDragstart"],Le=["alt","src","onError"],qe={class:"name"},Me=M({__name:"BuilderSidebarToolkit",setup(u){const v=E(V.core),s=E(V.builderManager),{removeInsertionCandidacy:p}=te(v),i=q(""),b=q({}),x=["Layout","Content","Input","Embed","Writer","Logic","Other"],w=_(()=>s.getMode()=="workflows"?"workflows":"core"),y=_(()=>{const c=x.map(d=>[d,$(d)]).filter(([d,g])=>g.length>0);return Object.fromEntries(c)}),B=_(()=>w.value=="core"?"Core toolkit":w.value=="workflows"?"Workflows toolkit":"Toolkit");function $(c){const g=ye().filter(e=>{const h=Y(e);return!(h.category!=c||!h.toolkit&&w.value!=="core"||h.toolkit&&h.toolkit!==w.value)}).map(e=>{const{name:h,description:R,category:W}=Y(e);return{type:e,name:h,description:R,category:W??"Other"}}),k=i.value.toLocaleLowerCase();return g.filter(e=>!k||e.name.toLocaleLowerCase().includes(k))}function A(c,d,g){b.value[d]=!0;const k=c.target;k.src=`./../../../../components/category_${g}.svg`}function O(c,d){s.setSelection(null),c.dataTransfer.setData(`application/json;writer=${d},`,"{}")}function z(c){p(c)}return ee(w,()=>{i.value=""}),(c,d)=>(a(),D(se,{modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=g=>i.value=g),class:"BuilderSidebarToolkit",placeholder:B.value},{default:L(()=>[(a(!0),m(I,null,X(y.value,(g,k)=>(a(),m("div",{key:k,class:"category"},[n("div",Ee,F(k),1),n("div",Ve,[(a(!0),m(I,null,X(g,o=>(a(),m("div",{key:o.type,class:"tool","data-writer-tooltip":o.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":o.type,onDragend:d[0]||(d[0]=e=>z(e)),onDragstart:e=>O(e,o.type)},[n("img",{alt:`(Icon for ${o.name})`,src:`./../../../../components/${o.type}.svg`,draggable:"false",onError:e=>b.value[o.type]?void 0:A(e,o.type,o.category)},null,40,Le),n("div",qe,F(o.name),1)],40,xe))),128))])]))),128))]),_:1},8,["modelValue","placeholder"]))}}),Pe=P(Me,[["__scopeId","data-v-23e9534b"]]),T=u=>(ae("data-v-6f0e2317"),u=u(),ne(),u),Ae=["draggable","data-automation-key"],We={key:0,class:"material-symbols-outlined"},je={key:1,class:"material-symbols-outlined"},Fe={class:"name"},Ne=T(()=>n("span",{class:"middot"},null,-1)),Oe=T(()=>n("i",{class:"material-symbols-outlined"},"bolt",-1)),ze=T(()=>n("span",{class:"middot"},null,-1)),Re=T(()=>n("i",{class:"material-symbols-outlined"},"visibility_off",-1)),Ue=T(()=>n("span",{class:"middot"},null,-1)),Ke=T(()=>n("i",{class:"material-symbols-outlined"},"terminal",-1)),Xe=T(()=>n("span",{class:"middot"},null,-1)),Ge={class:"previewText"},He={class:"children"},Je=M({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{},query:{}},emits:["expandBranch"],setup(u,{emit:v}){const s=E(V.core),p=E(V.builderManager),i=q(!1),b=_(()=>p.getSelectedId()==o.componentId),{createAndInsertComponent:x,moveComponent:w,goToComponentParentPage:y,isDraggingAllowed:B}=oe(s,p),{getComponentInfoFromDrag:$,removeInsertionCandidacy:A,isParentSuitable:O}=te(s),{isComponentVisible:z}=Se(s),c=q(null),d=v,g=_(()=>{var l,f;const t=(l=o.query)==null?void 0:l.toLocaleLowerCase();return!!(!t||(f=U.value)!=null&&f.name.toLocaleLowerCase().includes(t)||Object.values(e.value.content).filter(C=>C.toLocaleLowerCase().includes(t)).length>0)}),k=_(()=>!g.value),o=u,e=_(()=>s.getComponentById(o.componentId)),h=_(()=>s.getComponents(o.componentId,{sortedByPosition:!0})),R=_(()=>h.value.length==0),W=_(()=>{var C,J;const t=(C=U.value)==null?void 0:C.previewField;if(!t)return;const r=(J=e.value.content)==null?void 0:J[t];let l;const f=70;return(r==null?void 0:r.length)>f?l=r.substring(0,f)+"...":l=r,l}),U=_(()=>s.getComponentDefinition(e.value.type)),ie=_(()=>{var r,l,f,C;const t=e.value.type;return t=="html"&&((r=e.value.content)!=null&&r.element)?(l=e.value.content)==null?void 0:l.element:t=="workflows_workflow"?((f=e.value.content)==null?void 0:f.key)??"Workflow":((C=U.value)==null?void 0:C.name)??`Unknown (${e.value.type})`});async function H(){y(o.componentId),await N(),p.setSelection(o.componentId,void 0,"tree"),K()}function K(){i.value=!1,d("expandBranch")}function ce(){if(!c.value)return;const t=c.value.closest(".BuilderSidebarComponentTree"),r=t.getBoundingClientRect(),l=c.value.offsetTop-r.height/2;t.scrollTo({top:l,left:0,behavior:"smooth"})}function de(t){p.setSelection(null),t.dataTransfer.setData(`application/json;writer=${e.value.type},${e.value.id}`,"{}")}function ue(t){A(t)}function pe(t){const r=$(t);if(!r)return;const{draggedType:l,draggedId:f}=r;O(o.componentId,f,l)&&t.preventDefault()}function me(t){const r=$(t);if(!r)return;const{draggedType:l,draggedId:f}=r;f?w(f,e.value.id):x(l,e.value.id),A(t)}function fe(){i.value=!i.value}return ee(()=>p.getSelection(),async t=>{t&&t.componentId===o.componentId&&t.source!="tree"&&(K(),await N(),ce())},{immediate:!0}),(t,r)=>(a(),m("div",{ref_key:"rootEl",ref:c,class:"BuilderSidebarComponentTreeBranch"},[n("div",{class:ke(["main",{selected:b.value,notMatched:k.value,childless:R.value}]),tabindex:"0",draggable:Q(B)(t.componentId),"data-automation-key":e.value.type,onClick:H,onKeydown:be(H,["enter"]),onDragover:pe,onDragstart:de,onDragend:ue,onDrop:me},[h.value.length>0?(a(),D(G,{key:0,class:"collapser",variant:"neutral",size:"icon",onClick:we(fe,["stop"])},{default:L(()=>[i.value?(a(),m("i",We,"expand_more")):(a(),m("i",je,"expand_less"))]),_:1})):S("",!0),n("span",Fe,F(ie.value),1),Object.keys(e.value.handlers??{}).length>0?(a(),m(I,{key:1},[Ne,Oe],64)):S("",!0),Q(z)(e.value.id)?S("",!0):(a(),m(I,{key:2},[ze,Re],64)),e.value.isCodeManaged?(a(),m(I,{key:3},[Ue,Ke],64)):S("",!0),W.value?(a(),m(I,{key:4},[Xe,n("span",Ge,F(W.value),1)],64)):S("",!0)],42,Ae),Ce(n("div",He,[(a(!0),m(I,null,X(h.value,l=>(a(),D(re,{key:l.id,"component-id":l.id,query:t.query,onExpandBranch:K},null,8,["component-id","query"]))),128))],512),[[Ie,(!i.value||o.query)&&h.value.length>0]])],512))}}),re=P(Je,[["__scopeId","data-v-6f0e2317"]]),le=u=>(ae("data-v-957f04cc"),u=u(),ne(),u),Ye={class:"add"},Qe=le(()=>n("i",{class:"material-symbols-outlined"}," add ",-1)),Ze=le(()=>n("i",{class:"material-symbols-outlined"}," add ",-1)),et=M({__name:"BuilderSidebarComponentTree",setup(u){const v=E(V.core),s=E(V.builderManager),p=q(""),{createAndInsertComponent:i}=oe(v,s),b=_(()=>s.getMode()=="workflows"?"workflows_root":"root");async function x(){const y=i("page","root");v.setActivePageId(y),await N(),s.setSelection(y)}async function w(){const y=i("workflows_workflow","workflows_root");v.setActivePageId(y),await N(),s.setSelection(y)}return(y,B)=>(a(),D(se,{modelValue:p.value,"onUpdate:modelValue":B[0]||(B[0]=$=>p.value=$),class:"BuilderSidebarComponentTree",placeholder:"Component tree"},{default:L(()=>[j(re,{class:"rootBranch","component-id":b.value,query:p.value,"is-root":!0},null,8,["component-id","query"]),n("div",Ye,[b.value=="root"?(a(),D(G,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:x},{default:L(()=>[Qe,Z(" Add page")]),_:1})):S("",!0),b.value=="workflows_root"?(a(),D(G,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:w},{default:L(()=>[Ze,Z(" Add workflow")]),_:1})):S("",!0)])]),_:1},8,["modelValue"]))}}),tt=P(et,[["__scopeId","data-v-957f04cc"]]),ot={class:"BuilderSidebar"},at=M({__name:"BuilderSidebar",setup(u){return(v,s)=>(a(),m("div",ot,[j(Pe),j(tt)]))}}),st=P(at,[["__scopeId","data-v-6e95684f"]]);export{st as default};
